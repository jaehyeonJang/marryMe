<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>소원 트리</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: 'Segoe UI', sans-serif;
      background: #000;
      color: #fff;
    }

    .track {
      width: 100%;
      height: 100vh;
      transition: transform 0.7s ease;
    }

    .page {
      width: 100%;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      box-sizing: border-box;
      padding: 2rem;
    }

    .page h1 {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .page p {
      max-width: 800px;
      font-size: 1.2rem;
      line-height: 1.8;
      margin: 0 auto;
    }

    .page.content {
      align-items: flex-start;
      justify-content: flex-start;
      padding: 5vh 10vw;
      position: relative;
    }

    .scroll-content {
      width: 100%;
      overflow-y: auto;
      flex: 1;
      max-height: calc(100vh - 5rem); /* 제목 공간 제외 */
      padding-right: 1rem;
    }

    .scroll-content p {
      text-align: left;
      white-space: pre-wrap;
    }

    /* 인디케이터 */
    .indicator {
      position: fixed;
      top: 50%;
      right: 30px;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: 2px solid #fff;
      background: transparent;
      transition: background 0.3s;
    }

    .dot.active {
      background: #fff;
    }
  </style>
</head>
<body>

  <!-- ✅ 트랙: 페이지 묶음 -->
  <div class="track">

    <!-- ✅ 1페이지: 제목 -->
    <div class="page">
      <h1>소원 트리</h1>
      <p>기억은 원래 그 사람의 것이었지만,<br>더 이상 그 사람만의 것은 아닌 세상이 되었다.</p>
    </div>

    <!-- ✅ 2페이지: 작가의 말 -->
    <div class="page">
      <h1>작가의 말</h1>
      <p>이 이야기는 잊히지 못한 사람을 향한 작은 소원입니다.<br>이 페이지를 통해 누군가의 기억이 다시 이어지길 바랍니다.</p>
    </div>

    <!-- ✅ 3페이지: 본문 + 내부 스크롤 -->
    <div class="page content">
      <h1>소설 본문</h1>
      <div class="scroll-content">
        <p>
많은 것들이 바뀌는 시기에도  
결국 세상을 구성하는 다수는 평범한 사람들이었다.

여느 때와 마찬가지로 출근하고,  
일을 하고,  
퇴근 후 사랑하는 사람과 하루를 공유하며 주말을 기다렸다.

“네, 장재현입니다. 네.. 아 그런데 지금 미팅 중이라 내용을 메일로 주시면 제가 보고 답변드리겠습니다. 네, 수고하세요.”

아침부터 많은 문의 전화가 몰려들어도 머리 한 구석에는 가현과의 주말이 자리잡아 있었다...

(여기에 긴 본문 이어서)
        </p>
      </div>
    </div>

  </div>

  <!-- ✅ 인디케이터 -->
  <div class="indicator"></div>

  <script>
    const track = document.querySelector('.track');
    const pages = document.querySelectorAll('.page');
    const indicator = document.querySelector('.indicator');
    const scrollContent = document.querySelector('.scroll-content');
    let currentPage = 0;

    // 인디케이터 dot 생성
    pages.forEach((_, i) => {
      const dot = document.createElement('div');
      dot.classList.add('dot');
      if (i === currentPage) dot.classList.add('active');
      indicator.appendChild(dot);
    });

    const dots = document.querySelectorAll('.dot');

    function updateIndicator() {
      dots.forEach((dot, i) => {
        dot.classList.toggle('active', i === currentPage);
      });
    }

    function showPage(index) {
      currentPage = Math.round(index);
      track.style.transform = `translateY(-${100 * currentPage}vh)`;
      updateIndicator();
    }

    function nextPage() {
      if (currentPage < pages.length - 1) {
        currentPage++;
        showPage(currentPage);
      }
    }

    function prevPage() {
      if (currentPage > 0) {
        currentPage--;
        showPage(currentPage);
      }
    }

    showPage(currentPage);

    let isScrolling = false;

    // PC: wheel
    window.addEventListener('wheel', e => {
      if (isScrolling) return;

      if (currentPage === pages.length - 1) {
        const isAtTop = scrollContent.scrollTop === 0;
        if (e.deltaY < 0 && isAtTop) {
          isScrolling = true;
          prevPage();
          setTimeout(() => { isScrolling = false; }, 800);
          return;
        } else {
          return; // 내부 스크롤만 허용
        }
      }

      isScrolling = true;

      if (e.deltaY > 0) {
        nextPage();
      } else {
        prevPage();
      }

      setTimeout(() => {
        isScrolling = false;
      }, 800);
    });

    // 키보드
    window.addEventListener('keydown', e => {
      if (isScrolling) return;

      if (currentPage === pages.length - 1) {
        const isAtTop = scrollContent.scrollTop === 0;
        if (e.key === 'ArrowUp' && isAtTop) {
          isScrolling = true;
          prevPage();
          setTimeout(() => { isScrolling = false; }, 800);
          return;
        } else {
          return; // 내부 스크롤만 허용
        }
      }

      isScrolling = true;

      if (e.key === 'ArrowDown') {
        nextPage();
      } else if (e.key === 'ArrowUp') {
        prevPage();
      }

      setTimeout(() => {
        isScrolling = false;
      }, 800);
    });

    // 모바일 스와이프
    let touchStartY = 0;
    let touchEndY = 0;

    window.addEventListener('touchstart', e => {
      touchStartY = e.changedTouches[0].screenY;
    }, false);

    window.addEventListener('touchend', e => {
      touchEndY = e.changedTouches[0].screenY;
      handleGesture();
    }, false);

    function handleGesture() {
      if (isScrolling) return;

      if (currentPage === pages.length - 1) {
        const isAtTop = scrollContent.scrollTop === 0;
        if (touchEndY - touchStartY > 50 && isAtTop) {
          isScrolling = true;
          prevPage();
          setTimeout(() => { isScrolling = false; }, 800);
          return;
        } else {
          return; // 내부 스크롤만 허용
        }
      }

      isScrolling = true;

      if (touchStartY - touchEndY > 50) {
        nextPage();
      } else if (touchEndY - touchStartY > 50) {
        prevPage();
      }

      setTimeout(() => {
        isScrolling = false;
      }, 800);
    }
  </script>
</body>
</html>
